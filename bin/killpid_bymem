#!/bin/bash
top_mem=($(ps -eo pmem,user,pid | sort -k 1 -r | head -n 2))
total_memusg=$(free | grep Mem | awk '{print $4/$2 * 100.0}')

# check if the largest memory usage of a process satisfied conditions
# [$(echo "${top_mem[3]} > 20"|bc) -eq 1]

if [ ${top_mem[4]} != 'root' ] && [ $(echo "$total_memusg>85"|bc) -eq 1 ]
then
    echo "User: ${top_mem[4]}, PID: ${top_mem[5]} has used ${top_mem[3]}% memory, system has run out $total_memusg% memory, kill it."
    kill ${top_mem[5]}
fi

